/*
 Highcharts JS v8.0.0 (2020-02-13)

 Sonification module

 (c) 2012-2019 ystein Moseng

 License: www.highcharts.com/license
*/
(function(b){"object"===typeof module&&module.exports?(b["default"]=b,module.exports=b):"function"===typeof define&&define.amd?define("highcharts/modules/sonification",["highcharts"],function(m){b(m);b.Highcharts=m;return b}):b("undefined"!==typeof Highcharts?Highcharts:void 0)})(function(b){function m(c,b,f,n){c.hasOwnProperty(b)||(c[b]=n.apply(null,f))}b=b?b._modules:{};m(b,"modules/sonification/Instrument.js",[b["parts/Globals.js"],b["parts/Utilities.js"]],function(c,b){function f(d){this.init(d)}
var n=b.error,l=b.merge,k=b.pick,h={type:"oscillator",playCallbackInterval:20,oscillator:{waveformShape:"sine"}};f.prototype.init=function(d){this.initAudioContext()?(this.options=l(h,d),this.id=this.options.id=d&&d.id||c.uniqueKey(),d=c.audioContext,this.gainNode=d.createGain(),this.setGain(0),(this.panNode=d.createStereoPanner&&d.createStereoPanner())?(this.setPan(0),this.gainNode.connect(this.panNode),this.panNode.connect(d.destination)):this.gainNode.connect(d.destination),"oscillator"===this.options.type&&
this.initOscillator(this.options.oscillator),this.playCallbackTimers=[]):n(29)};f.prototype.copy=function(d){return new f(l(this.options,{id:null},d))};f.prototype.initAudioContext=function(){var d=c.win.AudioContext||c.win.webkitAudioContext,a=!!c.audioContext;return d?(c.audioContext=c.audioContext||new d,!a&&c.audioContext&&"running"===c.audioContext.state&&c.audioContext.suspend(),!!(c.audioContext&&c.audioContext.createOscillator&&c.audioContext.createGain)):!1};f.prototype.initOscillator=function(d){this.oscillator=
c.audioContext.createOscillator();this.oscillator.type=d.waveformShape;this.oscillator.connect(this.gainNode);this.oscillatorStarted=!1};f.prototype.setPan=function(d){this.panNode&&this.panNode.pan.setValueAtTime(d,c.audioContext.currentTime)};f.prototype.setGain=function(d,a){this.gainNode&&(1.2<d&&(console.warn("Highcharts sonification warning: Volume of instrument set too high."),d=1.2),a?(this.gainNode.gain.setValueAtTime(this.gainNode.gain.value,c.audioContext.currentTime),this.gainNode.gain.linearRampToValueAtTime(d,
c.audioContext.currentTime+a/1E3)):this.gainNode.gain.setValueAtTime(d,c.audioContext.currentTime))};f.prototype.cancelGainRamp=function(){this.gainNode&&this.gainNode.gain.cancelScheduledValues(0)};f.prototype.getValidFrequency=function(d,a,c){var e=this.options.allowedFrequencies,b=k(c,Infinity),h=k(a,-Infinity);return e&&e.length?e.reduce(function(a,c){return Math.abs(c-d)<Math.abs(a-d)&&c<b&&c>h?c:a},Infinity):d};f.prototype.clearPlayCallbackTimers=function(){this.playCallbackTimers.forEach(function(d){clearInterval(d)});
this.playCallbackTimers=[]};f.prototype.setFrequency=function(d,a){a=a||{};d=this.getValidFrequency(d,a.min,a.max);"oscillator"===this.options.type&&this.oscillatorPlay(d)};f.prototype.oscillatorPlay=function(d){this.oscillatorStarted||(this.oscillator.start(),this.oscillatorStarted=!0);this.oscillator.frequency.setValueAtTime(d,c.audioContext.currentTime)};f.prototype.preparePlay=function(){this.setGain(.001);"suspended"===c.audioContext.state&&c.audioContext.resume();this.oscillator&&!this.oscillatorStarted&&
(this.oscillator.start(),this.oscillatorStarted=!0)};f.prototype.play=function(d){var a=this,e=d.duration||0,g=function(c,e,g){var b=d.duration,h=0,k=a.options.playCallbackInterval;if("function"===typeof c){var f=setInterval(function(){h++;var d=h*k/b;if(1<=d)a[e](c(1),g),clearInterval(f);else a[e](c(d),g)},k);a.playCallbackTimers.push(f)}else a[e](c,g)};if(a.id)if("suspended"===c.audioContext.state||this.oscillator&&!this.oscillatorStarted)a.preparePlay(),setTimeout(function(){a.play(d)},10);else{a.playCallbackTimers.length&&
a.clearPlayCallbackTimers();a.cancelGainRamp();a.stopOscillatorTimeout&&(clearTimeout(a.stopOscillatorTimeout),delete a.stopOscillatorTimeout);a.stopTimeout&&(clearTimeout(a.stopTimeout),delete a.stopTimeout,a.stopCallback&&(a._play=a.play,a.play=function(){},a.stopCallback("cancelled"),a.play=a._play));var b=e<c.sonification.fadeOutDuration+20;a.stopCallback=d.onEnd;var h=function(){delete a.stopTimeout;a.stop(b)};e?(a.stopTimeout=setTimeout(h,b?e:e-c.sonification.fadeOutDuration),g(d.frequency,
"setFrequency",{minFrequency:d.minFrequency,maxFrequency:d.maxFrequency}),g(k(d.volume,1),"setGain",4),g(k(d.pan,0),"setPan")):h()}};f.prototype.mute=function(){this.setGain(.0001,.8*c.sonification.fadeOutDuration)};f.prototype.stop=function(d,a,e){var g=this,h=function(){g.stopOscillatorTimeout&&delete g.stopOscillatorTimeout;try{g.oscillator.stop()}catch(q){}g.oscillator.disconnect(g.gainNode);g.initOscillator(g.options.oscillator);a&&a(e);g.stopCallback&&g.stopCallback(e)};g.playCallbackTimers.length&&
g.clearPlayCallbackTimers();g.stopTimeout&&clearTimeout(g.stopTimeout);d?(g.setGain(0),h()):(g.mute(),g.stopOscillatorTimeout=setTimeout(h,c.sonification.fadeOutDuration+100))};return f});m(b,"modules/sonification/musicalFrequencies.js",[],function(){return[16.351597831287414,17.323914436054505,18.354047994837977,19.445436482630058,20.601722307054366,21.826764464562746,23.12465141947715,24.499714748859326,25.956543598746574,27.5,29.13523509488062,30.86770632850775,32.70319566257483,34.64782887210901,
36.70809598967594,38.890872965260115,41.20344461410875,43.653528929125486,46.2493028389543,48.999429497718666,51.91308719749314,55,58.27047018976124,61.7354126570155,65.40639132514966,69.29565774421802,73.41619197935188,77.78174593052023,82.4068892282175,87.30705785825097,92.4986056779086,97.99885899543733,103.82617439498628,110,116.54094037952248,123.47082531403103,130.8127826502993,138.59131548843604,146.8323839587038,155.56349186104046,164.81377845643496,174.61411571650194,184.9972113558172,195.99771799087463,
207.65234878997256,220,233.08188075904496,246.94165062806206,261.6255653005986,277.1826309768721,293.6647679174076,311.1269837220809,329.6275569128699,349.2282314330039,369.9944227116344,391.99543598174927,415.3046975799451,440,466.1637615180899,493.8833012561241,523.2511306011972,554.3652619537442,587.3295358348151,622.2539674441618,659.2551138257398,698.4564628660078,739.9888454232688,783.9908719634985,830.6093951598903,880,932.3275230361799,987.7666025122483,1046.5022612023945,1108.7305239074883,
1174.6590716696303,1244.5079348883237,1318.5102276514797,1396.9129257320155,1479.9776908465376,1567.981743926997,1661.2187903197805,1760,1864.6550460723597,1975.533205024496,2093.004522404789,2217.4610478149766,2349.31814333926,2489.0158697766474,2637.02045530296,2793.825851464031,2959.955381693075,3135.9634878539946,3322.437580639561,3520,3729.3100921447194,3951.066410048992,4186.009044809578]});m(b,"modules/sonification/utilities.js",[b["modules/sonification/musicalFrequencies.js"],b["parts/Utilities.js"]],
function(c,b){function f(c){this.init(c||[])}var n=b.clamp;f.prototype.init=function(c){this.supportedSignals=c;this.signals={}};f.prototype.registerSignalCallbacks=function(c){var b=this;b.supportedSignals.forEach(function(h){var d=c[h];d&&(b.signals[h]=b.signals[h]||[]).push(d)})};f.prototype.clearSignalCallbacks=function(c){var b=this;c?c.forEach(function(c){b.signals[c]&&delete b.signals[c]}):b.signals={}};f.prototype.emitSignal=function(c,b){var h;this.signals[c]&&this.signals[c].forEach(function(c){c=
c(b);h="undefined"!==typeof c?c:h});return h};return{musicalFrequencies:c,SignalHandler:f,getMusicalScale:function(b){return c.filter(function(c,h){var d=h%12+1;return b.some(function(a){return a===d})})},calculateDataExtremes:function(c,b){return c.series.reduce(function(c,d){d.points.forEach(function(a){a="undefined"!==typeof a[b]?a[b]:a.options[b];c.min=Math.min(c.min,a);c.max=Math.max(c.max,a)});return c},{min:Infinity,max:-Infinity})},virtualAxisTranslate:function(c,b,h){var d=b.max-b.min;c=
h.min+(h.max-h.min)*(c-b.min)/d;return 0<d?n(c,h.min,h.max):h.min}}});m(b,"modules/sonification/instrumentDefinitions.js",[b["modules/sonification/Instrument.js"],b["modules/sonification/utilities.js"]],function(c,b){var f={};["sine","square","triangle","sawtooth"].forEach(function(n){f[n]=new c({oscillator:{waveformShape:n}});f[n+"Musical"]=new c({allowedFrequencies:b.musicalFrequencies,oscillator:{waveformShape:n}});f[n+"Major"]=new c({allowedFrequencies:b.getMusicalScale([1,3,5,6,8,10,12]),oscillator:{waveformShape:n}})});
return f});m(b,"modules/sonification/Earcon.js",[b["parts/Globals.js"],b["parts/Utilities.js"]],function(c,b){function f(c){this.init(c||{})}var n=b.error,l=b.merge,k=b.pick;f.prototype.init=function(b){this.options=b;this.options.id||(this.options.id=this.id=c.uniqueKey());this.instrumentsPlaying={}};f.prototype.sonify=function(b){var d=l(this.options,b),a=k(d.volume,1),e=d.pan,g=this,f=b&&b.onEnd,h=g.options.onEnd;d.instruments.forEach(function(b){var d="string"===typeof b.instrument?c.sonification.instruments[b.instrument]:
b.instrument,r=l(b.playOptions),p="";if(d&&d.play){if(b.playOptions){"function"!==typeof b.playOptions.volume&&(r.volume=k(a,1)*k(b.playOptions.volume,1));r.pan=k(e,r.pan);var q=r.onEnd;r.onEnd=function(){delete g.instrumentsPlaying[p];q&&q.apply(this,arguments);Object.keys(g.instrumentsPlaying).length||(f&&f.apply(this,arguments),h&&h.apply(this,arguments))};b=d.copy();p=b.id;g.instrumentsPlaying[p]=b;b.play(r)}}else n(30)})};f.prototype.cancelSonify=function(c){var b=this.instrumentsPlaying,a=b&&
Object.keys(b);a&&a.length&&(a.forEach(function(a){b[a].stop(!c,null,"cancelled")}),this.instrumentsPlaying={})};return f});m(b,"modules/sonification/pointSonify.js",[b["parts/Globals.js"],b["parts/Utilities.js"],b["modules/sonification/utilities.js"]],function(c,b,f){var n=b.error,l=b.merge,k=b.pick,h={minDuration:20,maxDuration:2E3,minVolume:.1,maxVolume:1,minPan:-1,maxPan:1,minFrequency:220,maxFrequency:2200};return{pointSonify:function(b){var a=this,d=a.series.chart,g=b.dataExtremes||{},p=function(c,
b,d){return"function"===typeof c?b?function(b){return c(a,g,b)}:c(a,g):"string"===typeof c?(g[c]=g[c]||f.calculateDataExtremes(a.series.chart,c),f.virtualAxisTranslate(k(a[c],a.options[c]),g[c],d)):c};d.sonification.currentlyPlayingPoint=a;a.sonification=a.sonification||{};a.sonification.instrumentsPlaying=a.sonification.instrumentsPlaying||{};var q=a.sonification.signalHandler=a.sonification.signalHandler||new f.SignalHandler(["onEnd"]);q.clearSignalCallbacks();q.registerSignalCallbacks({onEnd:b.onEnd});
!a.isNull&&a.visible&&a.series.visible?b.instruments.forEach(function(b){var e="string"===typeof b.instrument?c.sonification.instruments[b.instrument]:b.instrument,g=b.instrumentMapping||{},f=l(h,b.instrumentOptions),k=e.id,r=function(c){b.onEnd&&b.onEnd.apply(this,arguments);d.sonification&&d.sonification.currentlyPlayingPoint&&delete d.sonification.currentlyPlayingPoint;a.sonification&&a.sonification.instrumentsPlaying&&(delete a.sonification.instrumentsPlaying[k],Object.keys(a.sonification.instrumentsPlaying).length||
q.emitSignal("onEnd",c))};e&&e.play?(a.sonification.instrumentsPlaying[e.id]=e,e.play({frequency:p(g.frequency,!0,{min:f.minFrequency,max:f.maxFrequency}),duration:p(g.duration,!1,{min:f.minDuration,max:f.maxDuration}),pan:p(g.pan,!0,{min:f.minPan,max:f.maxPan}),volume:p(g.volume,!0,{min:f.minVolume,max:f.maxVolume}),onEnd:r,minFrequency:f.minFrequency,maxFrequency:f.maxFrequency})):n(30)}):q.emitSignal("onEnd")},pointCancelSonify:function(c){var a=this.sonification&&this.sonification.instrumentsPlaying,
b=a&&Object.keys(a);b&&b.length&&(b.forEach(function(b){a[b].stop(!c,null,"cancelled")}),this.sonification.instrumentsPlaying={},this.sonification.signalHandler.emitSignal("onEnd","cancelled"))}}});m(b,"modules/sonification/chartSonify.js",[b["parts/Globals.js"],b["parts/Utilities.js"],b["modules/sonification/utilities.js"]],function(b,m,f){function c(a,b){return"function"===typeof b?b(a):v(a[b],a.options[b])}function l(a,b){return a.points.reduce(function(a,d){d=c(d,b);a.min=Math.min(a.min,d);a.max=
Math.max(a.max,d);return a},{min:Infinity,max:-Infinity})}function k(a,b,c){return(b||[]).reduce(function(b,c){Object.keys(c.instrumentMapping||{}).forEach(function(d){d=c.instrumentMapping[d];"string"!==typeof d||b[d]||(b[d]=f.calculateDataExtremes(a,d))});return b},u(c))}function h(a,c){return c.reduce(function(c,d){var e=d.earcon;d.condition?(d=d.condition(a),d instanceof b.sonification.Earcon?c.push(d):d&&c.push(e)):d.onPoint&&a.id===d.onPoint&&c.push(e);return c},[])}function d(a){return a.map(function(a){var c=
a.instrument;c=("string"===typeof c?b.sonification.instruments[c]:c).copy();return u(a,{instrument:c})})}function a(a,e){var g=e.timeExtremes||l(a,e.pointPlayTime,e.dataExtremes),z=k(a.chart,e.instruments,e.dataExtremes),A=d(e.instruments),p=a.points.reduce(function(a,d){var B=h(d,e.earcons||[]),k=f.virtualAxisTranslate(c(d,e.pointPlayTime),g,{min:0,max:e.duration});return a.concat(new b.sonification.TimelineEvent({eventObject:d,time:k,id:d.id,playOptions:{instruments:A,dataExtremes:z}}),B.map(function(a){return new b.sonification.TimelineEvent({eventObject:a,
time:k})}))},[]);return new b.sonification.TimelinePath({events:p,onStart:function(){if(e.onStart)e.onStart(a)},onEventStart:function(a){var c=a.options&&a.options.eventObject;if(c instanceof b.Point){if(!c.series.visible&&!c.series.chart.series.some(function(a){return a.visible}))return a.timelinePath.timeline.pause(),a.timelinePath.timeline.resetCursor(),!1;if(e.onPointStart)e.onPointStart(a,c)}},onEventEnd:function(a){var c=a.event&&a.event.options&&a.event.options.eventObject;if(c instanceof b.Point&&
e.onPointEnd)e.onPointEnd(a.event,c)},onEnd:function(){if(e.onEnd)e.onEnd(a)}})}function e(a,c,d){var e=d.seriesOptions||{};return u({dataExtremes:c,timeExtremes:l(a,d.pointPlayTime),instruments:d.instruments,onStart:d.onSeriesStart,onEnd:d.onSeriesEnd,earcons:d.earcons},y(e)?b.find(e,function(b){return b.id===v(a.id,a.options.id)})||{}:e,{pointPlayTime:d.pointPlayTime})}function g(a,c,d){if("sequential"===a||"simultaneous"===a){var e=c.series.reduce(function(a,b){b.visible&&a.push({series:b,seriesOptions:d(b)});
return a},[]);"simultaneous"===a&&(e=[e])}else e=a.reduce(function(a,e){e=t(e).reduce(function(a,e){var g;if("string"===typeof e){var f=c.get(e);f.visible&&(g={series:f,seriesOptions:d(f)})}else e instanceof b.sonification.Earcon&&(g=new b.sonification.TimelinePath({events:[new b.sonification.TimelineEvent({eventObject:e})]}));e.silentWait&&(g=new b.sonification.TimelinePath({silentWait:e.silentWait}));g&&a.push(g);return a},[]);e.length&&a.push(e);return a},[]);return e}function p(a,c){return c?
a.reduce(function(d,e,g){e=t(e);d.push(e);g<a.length-1&&e.some(function(a){return a.series})&&d.push(new b.sonification.TimelinePath({silentWait:c}));return d},[]):a}function q(a){return a.reduce(function(a,b){b=t(b);return a+(1===b.length&&b[0].options&&b[0].options.silentWait||0)},0)}function r(a){var c=a.reduce(function(a,b){(b=b.events)&&b.length&&(a.min=Math.min(b[0].time,a.min),a.max=Math.max(b[b.length-1].time,a.max));return a},{min:Infinity,max:-Infinity});a.forEach(function(a){var d=a.events,
e=d&&d.length,g=[];e&&d[0].time<=c.min||g.push(new b.sonification.TimelineEvent({time:c.min}));e&&d[d.length-1].time>=c.max||g.push(new b.sonification.TimelineEvent({time:c.max}));g.length&&a.addTimelineEvents(g)})}function w(a){return a.reduce(function(a,b){return a+t(b).reduce(function(a,b){return(b=b.series&&b.seriesOptions&&b.seriesOptions.timeExtremes)?Math.max(a,b.max-b.min):a},0)},0)}function x(c,d){var e=Math.max(d-q(c),0),g=w(c);return c.reduce(function(c,d){d=t(d).reduce(function(c,d){d instanceof
b.sonification.TimelinePath?c.push(d):d.series&&(d.seriesOptions.duration=d.seriesOptions.duration||f.virtualAxisTranslate(d.seriesOptions.timeExtremes.max-d.seriesOptions.timeExtremes.min,{min:0,max:g},{min:0,max:e}),c.push(a(d.series,d.seriesOptions)));return c},[]);c.push(d);return c},[])}var y=m.isArray,u=m.merge,v=m.pick,t=m.splat;return{chartSonify:function(a){var c=u(this.options.sonification,a);if(!1!==c.enabled){this.sonification.timeline&&this.sonification.timeline.pause();var d=k(this,
c.instruments,c.dataExtremes);a=g(c.order,this,function(a){return e(a,d,c)});a=p(a,c.afterSeriesWait||0);a=x(a,c.duration);a.forEach(function(a){r(a)});this.sonification.timeline=new b.sonification.Timeline({paths:a,onEnd:c.onEnd});this.sonification.timeline.play()}},seriesSonify:function(c){c=a(this,c);var d=this.chart.sonification;d.timeline&&d.timeline.pause();d.timeline=new b.sonification.Timeline({paths:[c]});d.timeline.play()},pause:function(a){this.sonification.timeline?this.sonification.timeline.pause(v(a,
!0)):this.sonification.currentlyPlayingPoint&&this.sonification.currentlyPlayingPoint.cancelSonify(a)},resume:function(a){this.sonification.timeline&&this.sonification.timeline.play(a)},rewind:function(a){this.sonification.timeline&&this.sonification.timeline.rewind(a)},cancel:function(a){this.pauseSonify(a);this.resetSonifyCursor()},getCurrentPoints:function(){if(this.sonification.timeline){var a=this.sonification.timeline.getCursor();return Object.keys(a).map(function(b){return a[b].eventObject}).filter(function(a){return a instanceof
b.Point})}return[]},setCursor:function(a){var b=this.sonification.timeline;b&&t(a).forEach(function(a){b.setCursor(a.id)})},resetCursor:function(){this.sonification.timeline&&this.sonification.timeline.resetCursor()},resetCursorEnd:function(){this.sonification.timeline&&this.sonification.timeline.resetCursorEnd()}}});m(b,"modules/sonification/Timeline.js",[b["parts/Globals.js"],b["parts/Utilities.js"],b["modules/sonification/utilities.js"]],function(b,m,f){function c(a){this.init(a||{})}function l(a){this.init(a)}
function k(a){this.init(a||{})}var h=m.merge,d=m.splat;c.prototype.init=function(a){this.options=a;this.time=a.time||0;this.id=this.options.id=a.id||b.uniqueKey()};c.prototype.play=function(a){var b=this.options.eventObject,c=this.options.onEnd,d=a&&a.onEnd,f=this.options.playOptions&&this.options.playOptions.onEnd;a=h(this.options.playOptions,a);b&&b.sonify?(a.onEnd=c||d||f?function(){var a=arguments;[c,d,f].forEach(function(b){b&&b.apply(this,a)})}:void 0,b.sonify(a)):(d&&d(),c&&c())};c.prototype.cancel=
function(a){this.options.eventObject.cancelSonify(a)};l.prototype.init=function(a){this.options=a;this.id=this.options.id=a.id||b.uniqueKey();this.cursor=0;this.eventsPlaying={};this.events=a.silentWait?[new c({time:0}),new c({time:a.silentWait})]:this.options.events;this.sortEvents();this.updateEventIdMap();this.signalHandler=new f.SignalHandler(["playOnEnd","masterOnEnd","onStart","onEventStart","onEventEnd"]);this.signalHandler.registerSignalCallbacks(h(a,{masterOnEnd:a.onEnd}))};l.prototype.sortEvents=
function(){this.events=this.events.sort(function(a,b){return a.time-b.time})};l.prototype.updateEventIdMap=function(){this.eventIdMap=this.events.reduce(function(a,b,c){a[b.id]=c;return a},{})};l.prototype.addTimelineEvents=function(a){this.events=this.events.concat(a);this.sortEvents();this.updateEventIdMap()};l.prototype.getCursor=function(){return this.events[this.cursor]};l.prototype.setCursor=function(a){a=this.eventIdMap[a];return"undefined"!==typeof a?(this.cursor=a,!0):!1};l.prototype.play=
function(a){this.pause();this.signalHandler.emitSignal("onStart");this.signalHandler.clearSignalCallbacks(["playOnEnd"]);this.signalHandler.registerSignalCallbacks({playOnEnd:a});this.playEvents(1)};l.prototype.rewind=function(a){this.pause();this.signalHandler.emitSignal("onStart");this.signalHandler.clearSignalCallbacks(["playOnEnd"]);this.signalHandler.registerSignalCallbacks({playOnEnd:a});this.playEvents(-1)};l.prototype.resetCursor=function(){this.cursor=0};l.prototype.resetCursorEnd=function(){this.cursor=
this.events.length-1};l.prototype.pause=function(a){var b=this;clearTimeout(b.nextScheduledPlay);Object.keys(b.eventsPlaying).forEach(function(c){b.eventsPlaying[c]&&b.eventsPlaying[c].cancel(a)});b.eventsPlaying={}};l.prototype.playEvents=function(a){var b=this,c=b.events[this.cursor],d=b.events[this.cursor+a],f=function(a){b.signalHandler.emitSignal("masterOnEnd",a);b.signalHandler.emitSignal("playOnEnd",a)};c.timelinePath=b;if(!1===b.signalHandler.emitSignal("onEventStart",c))f({event:c,cancelled:!0});
else if(b.eventsPlaying[c.id]=c,c.play({onEnd:function(a){a={event:c,cancelled:!!a};delete b.eventsPlaying[c.id];b.signalHandler.emitSignal("onEventEnd",a);d||f(a)}}),d){var h=Math.abs(d.time-c.time);1>h?(b.cursor+=a,b.playEvents(a)):this.nextScheduledPlay=setTimeout(function(){b.cursor+=a;b.playEvents(a)},h)}};k.prototype.init=function(a){this.options=a;this.cursor=0;this.paths=a.paths;this.pathsPlaying={};this.signalHandler=new f.SignalHandler(["playOnEnd","masterOnEnd","onPathStart","onPathEnd"]);
this.signalHandler.registerSignalCallbacks(h(a,{masterOnEnd:a.onEnd}))};k.prototype.play=function(a){this.pause();this.signalHandler.clearSignalCallbacks(["playOnEnd"]);this.signalHandler.registerSignalCallbacks({playOnEnd:a});this.playPaths(1)};k.prototype.rewind=function(a){this.pause();this.signalHandler.clearSignalCallbacks(["playOnEnd"]);this.signalHandler.registerSignalCallbacks({playOnEnd:a});this.playPaths(-1)};k.prototype.playPaths=function(a){var c=d(this.paths[this.cursor]),f=this.paths[this.cursor+
a],h=this,k=this.signalHandler,l=0,m=function(b){k.emitSignal("onPathStart",b);h.pathsPlaying[b.id]=b;b[0<a?"play":"rewind"](function(e){e=e&&e.cancelled;var g={path:b,cancelled:e};delete h.pathsPlaying[b.id];k.emitSignal("onPathEnd",g);l++;l>=c.length&&(f&&!e?(h.cursor+=a,d(f).forEach(function(b){b[0<a?"resetCursor":"resetCursorEnd"]()}),h.playPaths(a)):(k.emitSignal("playOnEnd",g),k.emitSignal("masterOnEnd",g)))})};c.forEach(function(a){a&&(a.timeline=h,setTimeout(function(){m(a)},b.sonification.fadeOutDuration))})};
k.prototype.pause=function(a){var b=this;Object.keys(b.pathsPlaying).forEach(function(c){b.pathsPlaying[c]&&b.pathsPlaying[c].pause(a)});b.pathsPlaying={}};k.prototype.resetCursor=function(){this.paths.forEach(function(a){d(a).forEach(function(a){a.resetCursor()})});this.cursor=0};k.prototype.resetCursorEnd=function(){this.paths.forEach(function(a){d(a).forEach(function(a){a.resetCursorEnd()})});this.cursor=this.paths.length-1};k.prototype.setCursor=function(a){return this.paths.some(function(b){return d(b).some(function(b){return b.setCursor(a)})})};
k.prototype.getCursor=function(){return this.getCurrentPlayingPaths().reduce(function(a,b){a[b.id]=b.getCursor();return a},{})};k.prototype.atStart=function(){return!this.getCurrentPlayingPaths().some(function(a){return a.cursor})};k.prototype.getCurrentPlayingPaths=function(){return d(this.paths[this.cursor])};return{TimelineEvent:c,TimelinePath:l,Timeline:k}});m(b,"modules/sonification/options.js",[],function(){return{sonification:{enabled:!1,duration:2E3,afterSeriesWait:1E3,order:"sequential",
pointPlayTime:"x",instruments:[{instrument:"sineMusical",instrumentMapping:{duration:400,frequency:"y",volume:.7},instrumentOptions:{minFrequency:392,maxFrequency:1046}}]}}});m(b,"modules/sonification/sonification.js",[b["parts/Globals.js"],b["parts/Utilities.js"],b["modules/sonification/Instrument.js"],b["modules/sonification/instrumentDefinitions.js"],b["modules/sonification/Earcon.js"],b["modules/sonification/pointSonify.js"],b["modules/sonification/chartSonify.js"],b["modules/sonification/utilities.js"],
b["modules/sonification/Timeline.js"],b["modules/sonification/options.js"]],function(b,m,f,n,l,k,h,d,a,e){var c=m.addEvent,p=m.extend,q=m.merge;b.sonification={fadeOutDuration:20,utilities:d,Instrument:f,instruments:n,Earcon:l,TimelineEvent:a.TimelineEvent,TimelinePath:a.TimelinePath,Timeline:a.Timeline};q(!0,b.defaultOptions,e);b.Point.prototype.sonify=k.pointSonify;b.Point.prototype.cancelSonify=k.pointCancelSonify;b.Series.prototype.sonify=h.seriesSonify;p(b.Chart.prototype,{sonify:h.chartSonify,
pauseSonify:h.pause,resumeSonify:h.resume,rewindSonify:h.rewind,cancelSonify:h.cancel,getCurrentSonifyPoints:h.getCurrentPoints,setSonifyCursor:h.setCursor,resetSonifyCursor:h.resetCursor,resetSonifyCursorEnd:h.resetCursorEnd});c(b.Chart,"init",function(){this.sonification={}});c(b.Chart,"update",function(a){(a=a.options.sonification)&&q(!0,this.options.sonification,a)})});m(b,"masters/modules/sonification.src.js",[],function(){})});
//# sourceMappingURL=sonification.js.map